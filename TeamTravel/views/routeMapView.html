<script>
    function startWatchingGeolocation() {
        navigator.geolocation.getCurrentPosition(geoWatchSuccess, geoWatchError, {
            enableHighAccuracy: true,
            maximumAge: 1000
        });
    }

    function geoWatchSuccess(position) {
        var lat = position.coords.latitude;
        var long = position.coords.longitude;
        var heading = position.coords.heading;
        var latlng = new google.maps.LatLng(lat, long);
        
        var map = new google.maps.Map( document.getElementById('mapView'),{
          center : latlng,
          zoom : 8,
          mapTypeId : google.maps.MapTypeId.ROADMAP
        });
        var startMarker = new google.maps.Marker({
            position: latlng,
            title: 'start',
            draggable: true,
            map: map
        });
        var endMarker = new google.maps.Marker({
            position: latlng,
            title: 'end',
            draggable: true,
            map: map
        });
        
        var directionsService = new google.maps.DirectionsService();
        
        google.maps.event.addListener(startMarker, 'dragend', function(event) {
          console.debug('final position is '+event.latLng.lat()+' / '+event.latLng.lng()); 
        });
        
        google.maps.event.addListener(endMarker, 'dragend', function(event) {
          directionsService.route({
                      origin:  new google.maps.LatLng(startMarker.position.lat, startMarker.position.long),
                      destination:  new google.maps.LatLng(endMarker.position.lat, endMarker.position.long),
                      unitSystem: google.maps.UnitSystem.IMPERIAL,
                      travelMode: google.maps.DirectionsTravelMode.DRIVING
                    },
                    function(result, status){
                      if (status == google.maps.DirectionsStatus.OK)
                        renderDirections(result);
                      else alert ("Directions request failed:"+status);
            });
        });
        
        function renderDirections(result) {

          var directionDisplay = new google.maps.DirectionsRenderer();
          directionDisplay.setMap(map);
          directionDisplay.setDirections(result);
          directionDisplay.setOptions({suppressMarkers: true});
        }
        
    }

    function geoWatchError(error) {
        alert("error " + error)
    }
</script>

<div id="mapView" data-role="view" data-title="Map" width="100%" height="250" src="#" alt="Google Static Map">
</div>